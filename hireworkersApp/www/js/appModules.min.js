app.controller('HomeCtrl', function(ApiEndpoint, LocalStorageFactory, $state, $scope,$cordovaDatePicker, $rootScope) {
  	
  	console.log('asda');
  	$scope.requestData = {};
  	$scope.requestData.datetimestring = "";


  	
  	if (!angular.isDefined(LocalStorageFactory.getObject('registerData').uuid)) {
        $state.go('login');
    }

    $scope.showDatetimePicker = function() {

    	console.log('showDatetimePicker called');

    	var optionsDate = {
	    date: new Date(),
	    mode: 'date', // or 'time'
	    minDate: new Date() - 10000,
	    allowOldDates: true,
	    allowFutureDates: false,
	    doneButtonLabel: 'DONE',
	    doneButtonColor: '#F2F3F4',
	    cancelButtonLabel: 'CANCEL',
	    cancelButtonColor: '#000000'
	  };
	  var optionsTime = {
	    date: new Date(),
	    mode: 'time', // or 'time'
	    minDate: new Date() - 10000,
	    allowOldDates: true,
	    allowFutureDates: false,
	    doneButtonLabel: 'DONE',
	    doneButtonColor: '#F2F3F4',
	    cancelButtonLabel: 'CANCEL',
	    cancelButtonColor: '#000000'
	  };
	  $cordovaDatePicker.show(optionsDate).then(function(date){
        

        var dateString = date.getFullYear() + '/' + date.getMonth() + '/' + date.getDate();
        //console.log(dateString);
        $cordovaDatePicker.show(optionsTime).then(function(time){
           var timeString = time.getHours() + ':' + time.getMinutes() + ':00'; 
            var dateTimeString = dateString + ' ' + timeString;
        	console.log(dateTimeString);
        	$scope.requestData.datetimestring = dateTimeString;

        });
      });
    };

    $scope.formRequest = function() {


    	console.log($scope.requestData);
    	$rootScope.requestData = $scope.requestData;

    	$state.go('app.home2');	

    }

    

});

app.controller('HistoryCtrl', function($http,$ionicLoading,ApiEndpoint, LocalStorageFactory, $state, $scope,$cordovaDatePicker, $rootScope, ApiEndpointPHP) {
  	

	console.log('History Controller');
	 


  $scope.giveFeedback = function(requestData) {
  	$rootScope.feedBackData = requestData;
  	$state.go('app.feedback');
  }
$ionicLoading.show();
var requestData = LocalStorageFactory.getObject('registerData');
console.log(requestData);
  var response = $http.post(ApiEndpointPHP.url + '/mobileapi.php?action=listrequest', requestData);
                response.success(function(data) {
                    $ionicLoading.hide();
                    console.log(data);
                    $scope.items = data;
                });

});

app.controller('FeedbackCtrl', function(ApiEndpoint, LocalStorageFactory, $state, $scope,$cordovaDatePicker, $rootScope,$http,ApiEndpointPHP, $ionicLoading) {

	$scope.feedBackData = $rootScope.feedBackData;
  console.log('Onfeedback page');
  $scope.feedbackRequest = {};
  // set the rate and max variables
  $scope.rating = {};
  $scope.feedbackRequest.feedbackstar = 0;
  $scope.rating.max = 5;

  $scope.feedbackRequest.requestuuid = $scope.feedBackData.requestid;

  $scope.giveFeedback = function() {

    console.log($scope.feedbackRequest);

     var response = $http.post(ApiEndpointPHP.url + '/mobileapi.php?action=newFeedback', $scope.feedbackRequest);
                response.success(function(data) {
                    $ionicLoading.hide();
                    console.log(data);
                   $rootScope.showAlert('Thank You');
                   $state.go('app.home');
    });


  }



});

app.controller('Home2Ctrl', function(ApiEndpoint, LocalStorageFactory, $state, $scope,$cordovaDatePicker, $rootScope, $http, $ionicLoading,ApiEndpointPHP) {

	console.log('home2Ctrl called');

	$scope.requestData = $rootScope.requestData;
  $scope.requestData.userid = LocalStorageFactory.getObject('registerData').uuid;

	$scope.processRequest = function() {

		console.log($scope.requestData);
     var response = $http.post(ApiEndpointPHP.url + '/mobileapi.php?action=createrequest', $scope.requestData);
                response.success(function(data) {
                    $ionicLoading.hide();
                    console.log(data);
                   $rootScope.showAlert('Successfully submitted');
                   $state.go('app.history');
    });

	};

});

app.controller('RegisterCtrl', function(LocalStorageFactory,$scope,ApiEndpoint, $http,$rootScope, $ionicLoading,$state) {
	$scope.registerData = {};


  $scope.goToRegister = function() {

    console.log('going to register');

    $state.go('register');

  }
	$scope.tryRegister = function() {

        var registerData = {};
        console.log('Inside tryRegister');

        //Check for Validations

        if (!$scope.registerData.fullname || $scope.registerData.fullname.length < 3) {
            $rootScope.showAlert('Please check your Name', 'Error');
            return;
        } else if (!$scope.registerData.phonenumber || $scope.registerData.phonenumber.length !== 10) {
            $rootScope.showAlert('Please check your phone Number !', 'Error');
            return;
        }
        else if (!$scope.registerData.email || $scope.registerData.email.length < 3) {
            $rootScope.showAlert('Please check your Email Id !', 'Error');
            return;
        }



        //$cordovaVibration.vibrate(100);

        registerData = $scope.registerData;
        //registerData.device = $cordovaDevice.getDevice();


        //Send Registration request to server
         $ionicLoading.show();
        console.log('===== ApiEndpoint : ' + ApiEndpoint.url);
        console.log('===== ' + JSON.stringify(registerData));

        var response = $http.post(ApiEndpoint.url + '/register/doregister', registerData);
                response.success(function(data) {
                    $ionicLoading.hide();
                    if (data.status == true) {
                    	console.log('received uuid = ' + data.uuid);
                        LocalStorageFactory.setObject('registerData', {
                            uuid: data.uuid
                        });
                        $state.go('app.home');
                    }
                });


        
    };


});


app.controller('LogoutCtrl', function(LocalStorageFactory,$scope,ApiEndpoint, $http,$rootScope, $ionicLoading,$state) {
   LocalStorageFactory.setObject('registerData', {});
   console.log('Inside Logout');
   $state.go('login'); 

  });

app.controller('LoginCtrl', function(LocalStorageFactory,$scope,ApiEndpoint, $http,$rootScope, $ionicLoading,$state, $ionicLoading, $http, ApiEndpointPHP) {
    
    $scope.loginData = {};
    console.log($scope.loginData);
    $scope.tryLogin = function() {
      console.log('try login called');
      console.log($scope.loginData);
       var response = $http.post(ApiEndpointPHP.url + '/mobileapi.php?action=signin', $scope.loginData);
                response.success(function(data) {
                   console.log('inside success');
                    if (data.result == true) {
                      console.log('received uuid = ' + data.uuid);
                        LocalStorageFactory.setObject('registerData', {
                            uuid: data.uuid
                        });
                        $state.go('app.home');
                    }
                });


        
    };



    

  });



